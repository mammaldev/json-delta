{
  "methods": [
    "mergePatch"
  ],
  "transforms": [
    {
      "description": "[ADD|UPDATE|DELETE]_PROPERTY changes to mutually exclusive set of properties",
      "methods": {
        "mergePatch": {
          "it": {
            "patch": "deep equal theirs"
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ],
        "baseYours": [
          { "path": [ "arr" ], "changeType": "DELETE_PROPERTY" },
          { "path": [ "bool" ], "changeType": "UPDATE_PROPERTY", "value": false },
          { "path": [ "obj", "y" ], "changeType": "ADD_PROPERTY", "value": true }
        ]
      },
      "expectation": {
        "success": true,
        "patch": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ],
        "conflicts": []
      }
    },
    {
      "description": "Identical changes on theirs and yours",
      "methods": {
        "mergePatch": {
          "it": {
            "patch": "empty array"
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ],
        "baseYours": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ]
      },
      "expectation": {
        "success": true,
        "patch": [],
        "conflicts": []
      }
    },
    {
      "description": "Conflicting [ADD|UPDATE|DELETE]_PROPERTY changes",
      "methods": {
        "mergePatch": {
          "it": {
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
          { "path": [ "str" ], "changeType": "UPDATE_PROPERTY", "value": "ing" }
        ],
        "baseYours": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 2 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": false },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
            "theirs": { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
            "yours": { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 2 }
          },
          {
            "theirs": { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": true },
            "yours": { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": false }
          },
          {
            "theirs": { "path": [ "str" ], "changeType": "UPDATE_PROPERTY", "value": "ing" },
            "yours": { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
          }
        ]
      }
    },
    {
      "description": "Conflicting, non-conflicting & identical [ADD|UPDATE|DELETE]_PROPERTY changes",
      "methods": {
        "mergePatch": {
          "it": {
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "key" ], "changeType": "ADD_PROPERTY", "value": 1 },
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": false },
          { "path": [ "str" ], "changeType": "UPDATE_PROPERTY", "value": "ing" }
        ],
        "baseYours": [
          { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 2 },
          { "path": [ "obj", "t" ], "changeType": "ADD_PROPERTY", "value": false },
          { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
            "theirs": { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 1 },
            "yours": { "path": [ "num" ], "changeType": "UPDATE_PROPERTY", "value": 2 }
          },
          {
            "theirs": { "path": [ "str" ], "changeType": "UPDATE_PROPERTY", "value": "ing" },
            "yours": { "path": [ "str" ], "changeType": "DELETE_PROPERTY" }
          }
        ]
      }
    },
    {
      "description": "One diff deletes property P, the other makes changes (not add id property) to P's descendents",
      "methods": {
        "mergePatch": {
          "it": {
            "conflicts": "Yes - deleting a property conflicts with changes to its descendents, except where those changes are adding an id to an array item object"
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "obj1" ], "changeType": "DELETE_PROPERTY" },
          { "path": [ "obj2", "arr", 0, "key" ], "changeType": "DELETE_PROPERTY" },
          { "path": [ "obj2", "arr" ], "changeType": "REMOVE_ITEMS", "indices": [ 0 ] },
          { "path": [ "obj2", "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 2, 1, 0 ] },
          { "path": [ "obj2", "arr" ], "changeType": "INSERT_ITEM", "index": 0, "item": {} }
        ],
        "baseYours": [
          { "path": [ "obj1", "key1" ], "changeType": "ADD_PROPERTY", "value": "value" },
          { "path": [ "obj1", "key2" ], "changeType": "UPDATE_PROPERTY", "value": "value" },
          { "path": [ "obj2" ], "changeType": "DELETE_PROPERTY" }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
            "theirs": { "path": [ "obj1" ], "changeType": "DELETE_PROPERTY" },
            "yours": { "path": [ "obj1", "key1" ], "changeType": "ADD_PROPERTY", "value": "value" }
          },
          {
            "theirs": { "path": [ "obj1" ], "changeType": "DELETE_PROPERTY" },
            "yours": { "path": [ "obj1", "key2" ], "changeType": "UPDATE_PROPERTY", "value": "value" }
          },
          {
            "theirs": { "path": [ "obj2", "arr", 0, "key" ], "changeType": "DELETE_PROPERTY" },
            "yours": { "path": [ "obj2" ], "changeType": "DELETE_PROPERTY" }
          },
          {
            "theirs": { "path": [ "obj2", "arr" ], "changeType": "REMOVE_ITEMS", "indices": [ 0 ] },
            "yours": { "path": [ "obj2" ], "changeType": "DELETE_PROPERTY" }
          },
          {
            "theirs": { "path": [ "obj2", "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 2, 1, 0 ] },
            "yours": { "path": [ "obj2" ], "changeType": "DELETE_PROPERTY" }
          },
          {
            "theirs": { "path": [ "obj2", "arr" ], "changeType": "INSERT_ITEM", "index": 0, "item": {} },
            "yours": { "path": [ "obj2" ], "changeType": "DELETE_PROPERTY" }
          }
        ]
      }
    },
    {
      "description": "One diff deletes property P, the other adds id property to descendents of P",
      "methods": {
        "mergePatch": {
          "it": {
            "conflicts": "No conflict - adding ids is an exceptional case"
          }
        }
      },
      "opts": {
        "idKeys": [ "id" ]
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "obj", "arr", 0, "id" ], "changeType": "ADD_PROPERTY", "value": "unique" }
        ],
        "baseYours": [
          { "path": [ "obj" ], "changeType": "DELETE_PROPERTY" }
        ]
      },
      "expectation": {
        "success": true,
        "patch": [],
        "conflicts": []
      }
    },
    {
      "description": "One diff removes array-item I, the other makes changes (not add id property) to I's descendents",
      "methods": {
        "mergePatch": {
          "it": {
            "conflicts": "Array-item removal conflicts with changes to item's descendents, except where those changes are adding id property to an array item object"
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "arr1" ], "changeType": "REMOVE_ITEMS", "indices": [ 0 ] },
          { "path": [ "arr2", 0, "key" ], "changeType": "ADD_PROPERTY", "value": true }
        ],
        "baseYours": [
          { "path": [ "arr1", 0, "key" ], "changeType": "UPDATE_PROPERTY", "value": false },
          { "path": [ "arr2" ], "changeType": "REMOVE_ITEMS", "indices": [ 0, 2 ] }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
              "theirs": { "path": [ "arr1" ], "changeType": "REMOVE_ITEMS", "indices": [ 0 ] },
              "yours": { "path": [ "arr1", 0, "key" ], "changeType": "UPDATE_PROPERTY", "value": false }
          },
          {
              "theirs": { "path": [ "arr2", 0, "key" ], "changeType": "ADD_PROPERTY", "value": true },
              "yours": { "path": [ "arr2" ], "changeType": "REMOVE_ITEMS", "indices": [ 0, 2 ] }
          }
        ]
      }
    },
    {
      "description": "One diff removes array-item I, the other adds id property to descendents of I",
      "methods": {
        "mergePatch": {
          "it": {
            "conflicts": "No conflict - adding ids is an exceptional case"
          }
        }
      },
      "opts": {
        "idKeys": [ "id" ]
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "arr", 0, "id" ], "changeType": "ADD_PROPERTY", "value": "unique1" },
          { "path": [ "arr", 0, "arr", 0, "id" ], "changeType": "ADD_PROPERTY", "value": "unique2" }
        ],
        "baseYours": [
          { "path": [ "arr" ], "changeType": "REMOVE_ITEMS", "indices": [ 0 ] }
        ]
      },
      "expectation": {
        "success": true,
        "patch": [],
        "conflicts": []
      }
    },
    {
      "description": "Items added to array A on both diffs",
      "methods": {
        "mergePatch": {
          "it": {
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 0 ], "value": { "ok": true } },
          { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 1 ], "value": { "ok": false } }
        ],
        "baseYours": [
          { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 0 ], "value": { "ok": true } }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
            "theirs": [
              { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 0 ], "value": { "ok": true } },
              { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 1 ], "value": { "ok": false } }
            ],
            "yours": [
              { "path": [ "arr" ], "changeType": "INSERT_ITEM", "index": [ 0 ], "value": { "ok": true } }
            ]
          }
        ]
      }
    },
    {
      "description": "Array A reordered on both diffs. Items also removed from A on one diff. Same order after item removals",
      "methods": {
        "mergePatch": {
          "it": {
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 4, 0, 3, 1, 2 ] }
        ],
        "baseYours": [
          { "path": [ "arr" ], "changeType": "REMOVE_ITEMS", "indices": [ 0, 3 ] },
          { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 2, 0, 1 ] }
        ]
      },
      "expectation": {
        "success": true,
        "patch": [],
        "conflicts": []
      }
    },
    {
      "description": "Array A reordered on both diffs. Items also removed from A on one diff. Different order.",
      "methods": {
        "mergePatch": {
          "it": {
            "conflicts": "For now this is classified as a conflict. It perhaps shouldn't be."
          }
        }
      },
      "diffs": {
        "baseTheirs": [
          { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 4, 0, 3, 1, 2 ] }
        ],
        "baseYours": [
          { "path": [ "arr" ], "changeType": "REMOVE_ITEMS", "indices": [ 0, 3 ] },
          { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 0, 2, 1 ] }
        ]
      },
      "expectation": {
        "success": false,
        "patch": null,
        "conflicts": [
          {
            "theirs": { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 4, 0, 3, 1, 2 ] },
            "yours": { "path": [ "arr" ], "changeType": "REORDER_ITEMS", "reordering": [ 0, 2, 1 ] }
          }
        ]
      }
    }
  ]
}
